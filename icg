%{
#include "y.tab.h"
%}

%%
[a-zA-Z][a-zA-Z0-9]*     { yylval.str = strdup(yytext); return ID; }
[0-9]+                   { yylval.str = strdup(yytext); return NUM; }
[ \t\n]                  ;   // ignore whitespace
.                        { return yytext[0]; }
%%
%{
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int tempCount = 1;

char* newTemp() {
    char* temp = malloc(10);
    sprintf(temp, "t%d", tempCount++);
    return temp;
}

int yylex(void);
int yyerror(char *s);
%}

%union {
    char *str;
}

%token <str> ID NUM
%type <str> expr

%%
stmt: ID '=' expr ';' { printf("%s = %s\n", $1, $3); }
    | ID '=' expr '\n' { printf("%s = %s\n", $1, $3); }
    ;

expr:
      expr '+' expr { 
                        char *t = newTemp();
                        printf("%s = %s + %s\n", t, $1, $3);
                        $$ = t;
                    }
    | expr '-' expr { 
                        char *t = newTemp();
                        printf("%s = %s - %s\n", t, $1, $3);
                        $$ = t;
                    }
    | expr '*' expr { 
                        char *t = newTemp();
                        printf("%s = %s * %s\n", t, $1, $3);
                        $$ = t;
                    }
    | expr '/' expr { 
                        char *t = newTemp();
                        printf("%s = %s / %s\n", t, $1, $3);
                        $$ = t;
                    }
    | '(' expr ')'  { $$ = $2; }
    | ID            { $$ = $1; }
    | NUM           { $$ = $1; }
    ;
%%

int main() {
    printf("Enter an arithmetic expression (e.g., a = b + c * d):\n");
    yyparse();
    return 0;
}

int yyerror(char *s) {
    printf("Error: %s\n", s);
    return 0;
}

int yywrap() { return 1; }
